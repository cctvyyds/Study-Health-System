C51 COMPILER V9.60.0.0   MAIN                                                              03/06/2022 15:11:52 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keil c51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\mai
                    -n.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "STC89Cxx.h"
   2          #include "intrins.h"
   3          #include "UART.h"
   4          #include "Delay.h"
   5          #include "Timer0.h"
   6          #include "Key.h"
   7          #include "pwm.h"
   8          #include "Reset.h"
   9          
  10          #define uchar unsigned char //宏定义，.相当于用uchar代替长度较长的unsigned char
  11          #define uint unsigned int
  12          sbit LED=P1^1;
  13          sbit HWX=P1^0;
  14          sbit PWM=P1^2;
  15          
  16          sbit key1=P1^3;
  17          sbit key2=P1^4;
  18          
  19          extern unsigned int a;
  20          extern unsigned int t;
  21          extern unsigned int time;
  22          uchar num=0;   //周期数
  23          uchar num_residue=0;   //剩余周期数
  24          uchar SBUF_review = 0  ;//定义SBUF接收
  25          uchar shuma[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};//数码管段码
  26          
  27          /*方法1，
  28          /**
  29            * @brief  确定人是否在区域内+防误判，有10s延时，可调
  30            * @param  无
  31            * @retval 无
  32            
  33          uint HWX_2()
  34          {
  35            unsigned char cd=0;//静态局部变量
  36            
  37            if(HWX==0)
  38            {
  39              Delay(10000);
  40              while(HWX==1);
  41              Delay(20);
  42              cd=0;
  43              }
  44            if(HWX==1)
  45            {
  46              Delay(20);
  47              while(HWX==0);
  48              Delay(20);
  49              cd=1;
  50              }
  51            
  52            return cd;
  53          }
  54          */
C51 COMPILER V9.60.0.0   MAIN                                                              03/06/2022 15:11:52 PAGE 2   

  55          
  56          
  57          /**
  58            * @brief  红外模块确定人是否在区域内+防误判，有延时，可调
  59            * @param  无
  60            * @retval 无
  61            *
  62            */
  63          uint HWX_2()
  64              {
  65   1            static uint flag =0,lastflag = 0;
  66   1            lastflag = flag;
  67   1            if (HWX == 0)
  68   1            {
  69   2             Delay(100);
  70   2                 if (HWX == 0)
  71   2                 {
  72   3                   flag = 0;
  73   3                 }else
  74   2                 {
  75   3                  flag =1;
  76   3                 }
  77   2            }else 
  78   1            { 
  79   2                flag =1;
  80   2            }
  81   1            if (flag && lastflag)
  82   1            {
  83   2             return 1;
  84   2            }else
  85   1            {
  86   2               return 0;
  87   2            }
  88   1          }
  89          
  90          
  91          void key_1() //按键扫描函数//按键扫描1，用于记录周期数
  92          {  
  93   1        if(key1==0)
  94   1       {
  95   2         Delay(50);
  96   2       
  97   2        if(key1==1)
  98   2        {
  99   3         num++;
 100   3         
 101   3        }
 102   2        }
 103   1       if(num>9)
 104   1       {
 105   2         num=0;
 106   2       }
 107   1      
 108   1      }
 109           
 110          
 111          void main ()
 112          {
 113   1        
 114   1      
 115   1        Timer0Init();//500um定时器开始工作
 116   1        
C51 COMPILER V9.60.0.0   MAIN                                                              03/06/2022 15:11:52 PAGE 3   

 117   1        while(1)
 118   1         { 
 119   2           PWM_up();//舵机开
 120   2         
 121   2         key_1(); //按键扫描函数周期扫描
 122   2        
 123   2         P2 = shuma[num];//数码管显示周期数
 124   2         
 125   2         if(key2 ==0)//不知道为什么，，HWM=1的时候按键2没反应，这样也挺好
 126   2          {   
 127   3            Delay(50);
 128   3            if(key2==1)
 129   3            {
 130   4              PWM_off();//舵机关
 131   4              break;//跳出该While循环
 132   4            }
 133   3           }
 134   2         } 
 135   1         
 136   1         
 137   1         
 138   1         
 139   1         
 140   1         
 141   1          a=1;  
 142   1            num_count = 0;
 143   1            UART_Init();//串口初始化声明
 144   1          while(1)
 145   1          {
 146   2            num_residue=num-num_count;
 147   2                
 148   2             P2 = shuma[num_residue];//数码管显示剩余周期数
 149   2      
 150   2          if(num_residue==0)
 151   2          {
 152   3         PWM_up();//舵机开
 153   3          }
 154   2            
 155   2          
 156   2      
 157   2          
 158   2            if( HWX_2()==1)//红外线部分
 159   2             {  
 160   3             LED=0;
 161   3               a=1;
 162   3             }else if( HWX_2()==0)
 163   2                      {
 164   3                      LED=1;
 165   3                        a=0;
 166   3                      }//如果红外线没检测到人，灭灯
 167   2                      
 168   2                      
 169   2                      
 170   2                      
 171   2                      
 172   2             if(time == 1)//如果过了一周期
 173   2          {
 174   3            a=0;//计时标志位清零
 175   3            t=0;
 176   3            time=0;//分钟数
 177   3             LED=1;//灭灯
 178   3           UART_SendByte(3);//串口发送3给B单片机
C51 COMPILER V9.60.0.0   MAIN                                                              03/06/2022 15:11:52 PAGE 4   

 179   3            while(1)
 180   3            {
 181   4            if(RI==1)
 182   4           {
 183   5            num_count++;
 184   5             RI=0;
 185   5             a=1;
 186   5             break;
 187   5           }
 188   4         }
 189   3      
 190   3          }
 191   2          } 
 192   1      }
 193          
 194          
 195          
 196          void UART_Routine() interrupt 4
 197          {
 198   1        if(RI==1)
 199   1        {
 200   2          SBUF_review = SBUF;
 201   2          RI=0;
 202   2        }
 203   1      }
 204          
 205          
 206          //定时器中断在pwm.c里
 207           //,如果实际操作中舵机抖动，加这句ES=0;            //关闭串行口中断允许控制位
 208          
 209          
 210          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    230    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
